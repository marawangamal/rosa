config:
   user: marawan.gamal # your username to check slurm status
   max_jobs: 10 # maximum number of jobs to run in parallel
   max_gpus: 10 # maximum number of GPUs to use in parallel

common_preamble_declarations:
  - "#!/bin/bash"
  - "#SBATCH --output=/home/mila/m/marawan.gamal/projects/rosa/outputs/slurm-%j.out"
  - "#SBATCH --error=/home/mila/m/marawan.gamal/projects/rosa/outputs/slurm-error-%j.out"
  - "#SBATCH --mem=10G                                         # Ask for 10 GB of RAM"

common_preamble_runs:
  # 1. Load the required modules
  - module load python/3.8

  # 2. Load your environment
  - source /home/mila/m/marawan.gamal/.venv/rosa/bin/activates

groups:
#https://github.com/lucidrains/imagen-pytorch
# ================================
# IMAGE CLASSIFICATION EXPERIMENTS
# ================================

#  - name: StanfordCars | ResNet50 (peft-method, rank, lr)
#    preamble:
#      - "#SBATCH --gres=gpu:1"
#      - "#SBATCH --time=3:00:00"
#    paralleljobs:
#      - python train_ic.py pmodel.method=loraconv2d pmodel.ignore=only1d pmodel.rank=2 train.lr=5e-3
#      - python train_ic.py pmodel.method=loraconv2d pmodel.ignore=only1d pmodel.rank=2 train.lr=5e-5
#      - python train_ic.py pmodel.method=loraconv2d pmodel.rank=2 train.lr=5e-4

  - name: StanfordCars | ResNet50 (peft-method, rank, lr)
    preamble:
      - "#SBATCH --gres=gpu:1"
#      - "#SBATCH --time=24:00:00"
#      - "#SBATCH --partition=unkillable"
    paralleljobs:
# rank=2
      - python train_ic.py dataset.name=FGVCAircraft pmodel.rank=2 pmodel.method=none train.lr=5e-3
      - python train_ic.py dataset.name=FGVCAircraft pmodel.rank=2 pmodel.method=none train.lr=5e-4
      - python train_ic.py dataset.name=FGVCAircraft pmodel.rank=2 pmodel.method=none train.lr=5e-5
      - python train_ic.py dataset.name=FGVCAircraft pmodel.rank=2 pmodel.method=last train.lr=5e-3
      - python train_ic.py dataset.name=FGVCAircraft pmodel.rank=2 pmodel.method=last train.lr=5e-4
      - python train_ic.py dataset.name=FGVCAircraft pmodel.rank=2 pmodel.method=last train.lr=5e-5
      - python train_ic.py dataset.name=FGVCAircraft pmodel.rank=2 pmodel.ignore=only1d pmodel.method=loraconv2d train.lr=5e-3
      - python train_ic.py dataset.name=FGVCAircraft pmodel.rank=2 pmodel.ignore=only1d pmodel.method=loraconv2d train.lr=5e-4
      - python train_ic.py dataset.name=FGVCAircraft pmodel.rank=2 pmodel.ignore=only1d pmodel.method=loraconv2d train.lr=5e-5
      - python train_ic.py dataset.name=FGVCAircraft pmodel.rank=2 pmodel.method=loraconv2d train.lr=5e-3
      - python train_ic.py dataset.name=FGVCAircraft pmodel.rank=2 pmodel.method=loraconv2d train.lr=5e-4
      - python train_ic.py dataset.name=FGVCAircraft pmodel.rank=2 pmodel.method=loraconv2d train.lr=5e-5
# rank=4
      - python train_ic.py dataset.name=FGVCAircraft pmodel.rank=4 pmodel.ignore=only1d pmodel.method=loraconv2d train.lr=5e-3
      - python train_ic.py dataset.name=FGVCAircraft pmodel.rank=4 pmodel.ignore=only1d pmodel.method=loraconv2d train.lr=5e-4
      - python train_ic.py dataset.name=FGVCAircraft pmodel.rank=4 pmodel.ignore=only1d pmodel.method=loraconv2d train.lr=5e-5
      - python train_ic.py dataset.name=FGVCAircraft pmodel.rank=4 pmodel.method=loraconv2d train.lr=5e-3
      - python train_ic.py dataset.name=FGVCAircraft pmodel.rank=4 pmodel.method=loraconv2d train.lr=5e-4
      - python train_ic.py dataset.name=FGVCAircraft pmodel.rank=4 pmodel.method=loraconv2d train.lr=5e-5
# rank=8
      - python train_ic.py dataset.name=FGVCAircraft pmodel.rank=8 pmodel.ignore=only1d pmodel.method=loraconv2d train.lr=5e-3
      - python train_ic.py dataset.name=FGVCAircraft pmodel.rank=8 pmodel.ignore=only1d pmodel.method=loraconv2d train.lr=5e-4
      - python train_ic.py dataset.name=FGVCAircraft pmodel.rank=8 pmodel.ignore=only1d pmodel.method=loraconv2d train.lr=5e-5
      - python train_ic.py dataset.name=FGVCAircraft pmodel.rank=8 pmodel.method=loraconv2d train.lr=5e-3
      - python train_ic.py dataset.name=FGVCAircraft pmodel.rank=8 pmodel.method=loraconv2d train.lr=5e-4
      - python train_ic.py dataset.name=FGVCAircraft pmodel.rank=8 pmodel.method=loraconv2d train.lr=5e-5




